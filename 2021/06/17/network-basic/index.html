<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;lionel223.github.io&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Gemini&quot;,&quot;version&quot;:&quot;8.5.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;right&quot;,&quot;display&quot;:&quot;always&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;buttons&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;Searching...&quot;,&quot;empty&quot;:&quot;We didn&#39;t find any results for the search: ${query}&quot;,&quot;hits_time&quot;:&quot;${hits} results found in ${time} ms&quot;,&quot;hits&quot;:&quot;${hits} results found&quot;}}</script><script src="/js/config.js"></script>
<meta name="description" content="在現今的時代，每個人都在使用網路，舉凡是手機、電腦、或是其餘穿戴的設備等等，可能都會使用到網路，底下就來介紹網路到底是什麼東西。">
<meta property="og:type" content="article">
<meta property="og:title" content="網路基本概念">
<meta property="og:url" content="https://lionel223.github.io/2021/06/17/network-basic/index.html">
<meta property="og:site_name" content="Lionel&#39;s Blog">
<meta property="og:description" content="在現今的時代，每個人都在使用網路，舉凡是手機、電腦、或是其餘穿戴的設備等等，可能都會使用到網路，底下就來介紹網路到底是什麼東西。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://lionel223.github.io/image/2021-06-17-network-basic/network_components.png">
<meta property="og:image" content="https://linux.vbird.org/linux_server/centos6/0110network_basic//osi_tcpip.gif">
<meta property="og:image" content="https://linux.vbird.org/linux_server/centos6/0110network_basic//csmacd.gif">
<meta property="og:image" content="https://lionel223.github.io/image/2021-06-17-network-basic/ipv4-header.png">
<meta property="og:image" content="https://linux.vbird.org/linux_server/centos6/0110network_basic//packet_total.png">
<meta property="og:image" content="https://lionel223.github.io/image/2021-06-17-network-basic/tcp-header.png">
<meta property="og:image" content="https://media.geeksforgeeks.org/wp-content/uploads/TCP-connection-1.png">
<meta property="article:published_time" content="2021-06-17T00:00:19.000Z">
<meta property="article:modified_time" content="2021-06-17T00:00:19.000Z">
<meta property="article:author" content="Lionel">
<meta property="article:tag" content="network">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lionel223.github.io/image/2021-06-17-network-basic/network_components.png">


<link rel="canonical" href="https://lionel223.github.io/2021/06/17/network-basic/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;en&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;https:&#x2F;&#x2F;lionel223.github.io&#x2F;2021&#x2F;06&#x2F;17&#x2F;network-basic&#x2F;&quot;,&quot;path&quot;:&quot;2021&#x2F;06&#x2F;17&#x2F;network-basic&#x2F;&quot;,&quot;title&quot;:&quot;網路基本概念&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>網路基本概念 | Lionel's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Lionel's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E9%BA%BC%E6%98%AF%E7%B6%B2%E8%B7%AF"><span class="nav-text">什麼是網路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B6%B2%E8%B7%AF%E7%9A%84%E7%B5%84%E6%88%90"><span class="nav-text">網路的組成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B6%B2%E8%B7%AF%E7%9A%84%E5%8D%80%E5%9F%9F%E7%AF%84%E5%9C%8D"><span class="nav-text">網路的區域範圍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%BB%E8%85%A6%E7%B6%B2%E8%B7%AF%E9%80%9A%E8%A8%8A%E5%8D%94%E5%AE%9A%EF%BC%9A-TCP-IP"><span class="nav-text">電腦網路通訊協定： TCP&#x2F;IP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-IP-%E7%9A%84%E9%8F%88%E7%B5%90%E5%B1%A4"><span class="nav-text">TCP&#x2F;IP 的鏈結層</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WAN%E4%BD%BF%E7%94%A8%E7%9A%84%E8%A8%AD%E5%82%99"><span class="nav-text">WAN使用的設備</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LAN%E4%BD%BF%E7%94%A8%E7%9A%84%E8%A8%AD%E5%82%99"><span class="nav-text">LAN使用的設備</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B9%99%E5%A4%AA%E7%B6%B2%E8%B7%AF%E5%82%B3%E8%BC%B8%E5%8D%94%E5%AE%9A-CSMA-CD"><span class="nav-text">乙太網路傳輸協定 - CSMA&#x2F;CD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A8%8A%E6%A1%86%E7%9A%84%E5%B0%81%E8%A3%9D%E6%A0%BC%E5%BC%8F"><span class="nav-text">訊框的封裝格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MTU-%E6%9C%80%E5%A4%A7%E5%82%B3%E8%BC%B8%E5%96%AE%E4%BD%8D"><span class="nav-text">MTU 最大傳輸單位</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-IP-%E7%9A%84%E7%B6%B2%E8%B7%AF%E5%B1%A4"><span class="nav-text">TCP&#x2F;IP 的網路層</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IP-%E7%9A%84%E8%A1%A8%E9%A0%AD"><span class="nav-text">IP 的表頭</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-IP-%E7%9A%84%E5%82%B3%E8%BC%B8%E5%B1%A4"><span class="nav-text">TCP&#x2F;IP 的傳輸層</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP%E7%9A%84%E8%A1%A8%E9%A0%AD"><span class="nav-text">TCP的表頭</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#port"><span class="nav-text">port</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP-%E7%9A%84%E9%80%A3%E7%B7%9A%E6%A9%9F%E5%88%B6"><span class="nav-text">TCP 的連線機制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%A6%E4%B8%80%E7%A8%AE%E5%8D%94%E5%AE%9A%EF%BC%9AUDP"><span class="nav-text">另一種協定：UDP</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B6%B2%E8%B7%AF%E7%9A%84%E9%98%B2%E7%81%AB%E7%89%86"><span class="nav-text">網路的防火牆</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-text">Reference</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lionel</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Lionel223" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Lionel223" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lionel223.github.io/2021/06/17/network-basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lionel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lionel's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          網路基本概念
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-17 00:00:19" itemprop="dateCreated datePublished" datetime="2021-06-17T00:00:19+00:00">2021-06-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>在現今的時代，每個人都在使用網路，舉凡是手機、電腦、或是其餘穿戴的設備等等，可能都會使用到網路，底下就來介紹網路到底是什麼東西。</p>
<span id="more"></span>

<h2 id="什麼是網路"><a href="#什麼是網路" class="headerlink" title="什麼是網路"></a>什麼是網路</h2><p>網際網路的起源可以追朔到1960年代末期，當時美國國防部為了軍事的需要而主導一個計畫，此計畫由 DARPA（Defense Advanced Research Project Agency）負責，其目的是研究一個可在不同網路硬體上運作的軟體技術，讓各個電腦可透過此軟體達成資料的溝通，此系統稱為 ARPANET（Advanced Research Projects Agency Network），這個即是 TCP/IP 的雛形。</p>
<p>在1975年左右，APPANET已經可以各種硬體平台底下互通資料了。後來在1980年，DAPRA正式推出 TCP/IP，並將 TCP/IP 植入BSD Unix系統內，後來 TCP/IP 這項技術就吸引越來越多人使用，而這個連接網路的技術也被稱之為 Internet。</p>
<h2 id="網路的組成"><a href="#網路的組成" class="headerlink" title="網路的組成"></a>網路的組成</h2><p>接下來介紹網路的組成，可參考以下圖片</p>
<p><img src="/image/2021-06-17-network-basic/network_components.png" alt="network_components"></p>
<center><font color=#BBBBBB>圖片來源：</font><a target="_blank" rel="noopener" href="https://linux.vbird.org/">鳥哥伺服器篇</a></center>

<p>上圖大致上由以下硬體組成：</p>
<ul>
<li><p>節點（node）</p>
<p>節點主要是具有網路位址（IP）的設備，一般PC、Linux伺服器、印表機、ADSL數據機都可視為一個節點，但中間的集線器（hub）因為不具有 IP，所以不是節點</p>
</li>
<li><p>伺服器主機（server）</p>
<p>可提供資料來回應給用戶的主機</p>
</li>
<li><p>用戶端（client）</p>
<p>可主動發起連線去要求資料，都可稱為用戶端，例如一台電腦對 google 搜尋資料，則電腦可稱為用戶端</p>
</li>
<li><p>網路卡（NIC，Network Interface Card）</p>
<p>內建或外插在主機上的一個設備，可提供網路連線，一般的節點都有一個或以上的網路卡</p>
</li>
<li><p>網路介面</p>
<p>利用軟體設計出來的網路介面，主要在提供網路位址（IP）的任務。 一張網卡至少可以搭配一個以上的網路介面</p>
</li>
<li><p>網關（route）或通訊閘（gateway）</p>
<p>具有兩個以上的網路介面， 可以連接兩個以上不同的網段的設備，例如 IP 分享器就是一個常見的網關設備。而上面的 ADSL 數據機則不太能算是網關，因為數據機通常視為一個在主機內的網卡設備。</p>
</li>
</ul>
<h2 id="網路的區域範圍"><a href="#網路的區域範圍" class="headerlink" title="網路的區域範圍"></a>網路的區域範圍</h2><p>依據距離不同、線材不同，網路的使用大致上又分為 LAN、WAN，底下就來詳細介紹</p>
<ul>
<li><p>區域網路（LAN，Local Area Network）</p>
<p>距離較近，可使用較昂貴的線材，通常使用於校區內或是一棟大樓內，網路速度較快且連線品質較佳。</p>
</li>
<li><p>廣域網路（WAN，Wide Area Network）</p>
<p>傳輸距離較遠，可能是城市之間的距離，線材較便宜</p>
</li>
</ul>
<h2 id="電腦網路通訊協定：-TCP-IP"><a href="#電腦網路通訊協定：-TCP-IP" class="headerlink" title="電腦網路通訊協定： TCP/IP"></a>電腦網路通訊協定： TCP/IP</h2><p>由 ARPANET 發展而來的 TCP/IP 是使用 OSI（Open System Interconnection） 七層協定的觀念， 所以同樣具有分層的架構，只是將它簡化為四層，在結構上面比較沒有這麼嚴謹</p>
<p><img src="https://linux.vbird.org/linux_server/centos6/0110network_basic//osi_tcpip.gif" alt="osi_tcpip"></p>
<center>OSI 與 TCP/IP 協定之相關性<br /><font color=#BBBBBB>圖片來源：</font><a target="_blank" rel="noopener" href="https://linux.vbird.org/">鳥哥伺服器篇</a></center>

<p>以下就來介紹 TCP/IP的運作流程，假設要使用 google 的網站，整個連線過程如下：</p>
<ol>
<li>應用程式階段：打開瀏覽器，在瀏覽器上面輸入網址列，按下 [Enter]。此時網址列與相關資料會被瀏覽器包成一個資料， 並向下傳給 TCP/IP 的應用層</li>
<li>應用層：由應用層提供的 HTTP 通訊協定，將來自瀏覽器的資料包起來，並給予一個應用層表頭，再向傳送層丟去</li>
<li>傳送層：由於 HTTP 為可靠連線，所以將該資料丟入 TCP 封包內，並給予一個 TCP 封包的表頭，向網路層丟去</li>
<li>網路層：將 TCP 包裹包進 IP 封包內，再給予一個 IP 表頭（來源與目標的 IP），向鏈結層丟去</li>
<li>鏈結層：若使用乙太網路，此時 IP 會依據 CSMA/CD 的標準，包裹到 MAC 訊框中，並給予 MAC 表頭，再轉成位元串後， 利用傳輸媒體傳送到遠端主機上。</li>
</ol>
<p>當 Google 收到包裹時，會再依據相反方向拆解，並交由對應的分層處理，Google 伺服器就會得到資料，然後再包裝起來傳回去瀏覽器。</p>
<p>下面就分別介紹 TCP/IP 各層的功能</p>
<h3 id="TCP-IP-的鏈結層"><a href="#TCP-IP-的鏈結層" class="headerlink" title="TCP/IP 的鏈結層"></a>TCP/IP 的鏈結層</h3><p>最底層的連結層主要和硬體比較有關係，接下來就介紹 WAN 與 LAN 的硬體，以及MAC訓匡格式</p>
<h4 id="WAN使用的設備"><a href="#WAN使用的設備" class="headerlink" title="WAN使用的設備"></a>WAN使用的設備</h4><p>廣域網路設備通常較便宜，下面是常用的設備</p>
<ul>
<li><p>傳統電話撥接</p>
<p>早期網路使用方式，透過數據機加上電話線以及電腦的九針序列埠，使用ppp協定（Point-to-Point Protocol）配合撥接程式來取得 IP 並上網</p>
</li>
<li><p>整合服務數位網路（ISDN，Integrated Services DIgital Network）</p>
<p>也是利用電話線路，但連線兩端都需要 ISDN 的數據機才能使用連線功能，在台灣較少見</p>
</li>
<li><p>非對稱數位用路回路 (ADSL，Asymmetric Digital Subscriber Line)</p>
<p>也是透過電話線路撥接來取得 IP，但使用的是電話的高頻，與一般電話的頻率不同，所以可以上網並使用電話，由於上傳/下載的頻寬不同， 因此才稱為非對稱的回路。<br>ADSL也是使用數據機，但他使用的是 PPPoE（PPP over Ethernet）的方法，就是將PPP協定在乙太網路卡上使用，所以主機還需要一張網路卡才能連接到數據機，並用撥接程式取得新的介面（ppp0）</p>
</li>
<li><p>纜線數據機 (Cable modem)</p>
<p>使用有線電視的纜線作為網路訊號媒體，同樣需要數據機才能連線到 ISP（Internet Service Provider）</p>
</li>
</ul>
<h4 id="LAN使用的設備"><a href="#LAN使用的設備" class="headerlink" title="LAN使用的設備"></a>LAN使用的設備</h4><p>區域網路最常用的就是乙太網路，另外還有光纖網路等等的設備，乙太網路已經標準化，所以設備費用相對較低廉。</p>
<p>早先 IEEE 制定乙太網路標準為 802.3 的 IEEE 10BASE5，10BASE5表示『資料傳輸速度為 10Mbps（M bits/second），BASE 表示使用基頻信號傳輸，每個節點最長可達500公尺』。後來又制訂了 802.3u 來支援 100Mbps 傳輸速度的 100BASE-T，線材製作更精密。</p>
<p>傳輸速度增加時，因為線材互相電磁效應會加強，所以線材製作要求就越來越嚴格，所以網路傳輸速度想增加時，除了網卡要升級，連接主機的集線器、交換器要升級，網路線也需要升級</p>
<p>※ 有些網路傳輸速度寫下行/上行 2Mbps/128Kbps，那個 Kb 是指 bits，所以還要除以8，也就是 256KBps/16KBps（KBytes per second）</p>
<h4 id="乙太網路傳輸協定-CSMA-CD"><a href="#乙太網路傳輸協定-CSMA-CD" class="headerlink" title="乙太網路傳輸協定 - CSMA/CD"></a>乙太網路傳輸協定 - CSMA/CD</h4><p>乙太網路的傳輸就是網路卡跟網路卡之間的資料傳遞，每個乙太網路卡都有一個唯一的卡號，稱為 MAC（Media Access Control），網卡之間的資料傳輸則是透過 IEEE 802.3 的標準 CSMA/CD（Carrier Sense Multiple Access with Collision Detection），我們以下圖來解釋機制</p>
<p><img src="https://linux.vbird.org/linux_server/centos6/0110network_basic//csmacd.gif" alt="csmacd"></p>
<center>連線示意圖：A發送資料至C<br /><font color=#BBBBBB>圖片來源：</font><a target="_blank" rel="noopener" href="https://linux.vbird.org/">鳥哥伺服器篇</a></center>

<p>上圖的 Hub 就是集線器，各主機都是連線到集線器，透過集線器向所有主機發起連線，集線器是一種網路共享媒體，在單一時間點僅能被一部主機使用，當要將 A 的資料發送至 C 時，流程如下：</p>
<ol>
<li><p>監聽媒體使用狀況（Carrier Sense）</p>
<p>A 主機發送封包錢，要先監聽確認沒人使用時，才能發送訊框（frame）</p>
</li>
<li><p>多點傳輸（Multiple Access）</p>
<p>A 主機發送的訊息會被集線器複製一份，並傳送給連線他的所有主機，因為目標是 C 主機，所以其餘主機會將此訊框拋棄，只有 C 會抓取</p>
</li>
<li><p>碰撞偵測（Collision Detection）</p>
<p>若其餘主機也剛好發送訊框給 C 主機時，那麼會發生損毀，那麼發送的主機要各自隨機等待一段時間再重新發送</p>
</li>
</ol>
<p>根據上面的機制可以知道以下結論</p>
<ul>
<li>就算沒使用網路，但集線器的燈號也會閃爍，是因為可能有其他主機在對外連線</li>
<li>訊框也會被其餘電腦攔截，所以資料必須加密</li>
</ul>
<h4 id="訊框的封裝格式"><a href="#訊框的封裝格式" class="headerlink" title="訊框的封裝格式"></a>訊框的封裝格式</h4><p>前面提的標準標準 CSMA/CD，傳輸的訊框（fram）資料其實就是 MAC。訊框資料上有兩個重要的資料：目標網卡卡號、來源網卡卡號，所以我們又簡稱網卡卡號為 MAC，可以想像 MAC 是一個傳遞的包裹，這個包裹式傳送資料的最小單位，下面這個就是 MAC 訊框的內容</p>
<table>
<thead>
<tr>
<th>前導碼<br />8 Bytes</th>
<th>目的位址<br />6 Bytes</th>
<th>來源位址<br />6 Bytes</th>
<th>資料欄位通訊<br />2 Bytes</th>
<th>主要資料<br />46~1500 Bytes</th>
<th>檢查碼<br />4 Bytes</th>
</tr>
</thead>
</table>
<p>上面的目的與來源位址指的就是網卡卡號（硬體位址，hardward address），每個卡號都是唯一，其範圍是 00:00:00:00:00:00 ~ FF:FF:FF:FF:FF:FF，這 6 bytes 中，前面 3 bytes 為廠商代碼， 後面3 bytes 為廠商自行設定的裝置碼，在 Linux 中，可以使用指令 <code>ipconfig</code> 來查詢網路卡號；另外若跨不同網域時，來源位址與目的位址也會跟著改變，因為會在不同網域的主機之間傳送，所以硬體位址會改變，所以同一訊框的表頭會跟著變化</p>
<p>※ 訊框內的主要資料為何最小要 46 bytes，是因為若要偵測碰撞時，訊框總資料最少要有 64 bytes，扣除其餘資料，主要資料至少要有 46 bytes 才能達成此條件，所以傳輸資料若小於 46 bytes，系統也會主動填上填充碼來補齊至 46 bytes</p>
<h4 id="MTU-最大傳輸單位"><a href="#MTU-最大傳輸單位" class="headerlink" title="MTU 最大傳輸單位"></a>MTU 最大傳輸單位</h4><p>MTU（Maximum Transmission Unit）是指網路訊框所能傳送的最大資料量，在乙太網路上，標準定義為1500 bytes。</p>
<p>在 IP 封包裡，封包最大可到 65535 bytes，比 MTU 還要大，所以 IP 封包是可以拆解並放到 MAC 中，到達目的後再組裝回來的。</p>
<h3 id="TCP-IP-的網路層"><a href="#TCP-IP-的網路層" class="headerlink" title="TCP/IP 的網路層"></a>TCP/IP 的網路層</h3><p>前面說到，在硬體部分，乙太網路上面的傳輸使用網路卡卡號為基準的 MAC 訊框，配合 CSMA/CD 的標準來傳送訊框；而在軟體部分，Internet 可以算是 TCP/IP的通稱，其中一個重點就是 IP（Internet Protocol），目前 IP 有兩個版本，分別是 IPv4（Internet Protocol version 4），另一種則是 IPv6 （Internet Protocol version 6）</p>
<p>IPv4 可紀錄的位址只有 32 位元，而 IPv6 可紀錄的位址則有 128 位元，所以未來 IPv6 的使用會越來越多。</p>
<h4 id="IP-的表頭"><a href="#IP-的表頭" class="headerlink" title="IP 的表頭"></a>IP 的表頭</h4><p><img src="/image/2021-06-17-network-basic/ipv4-header.png" alt="ipv4-header"></p>
<center>IPv4封包的表頭<br /><font color=#BBBBBB>圖片來源：</font><a target="_blank" rel="noopener" href="https://advancedinternettechnologies.wordpress.com/ipv4-header/">IPv4 Header</a></center>

<p>上圖每一行佔用的位元數皆是 32 bits，以下是個別內容介紹</p>
<ul>
<li><p>Version</p>
<p>IP 封包的版本，例如這邊使用的是 IPv4</p>
</li>
<li><p>Header Length</p>
<p>IHL（Internet Header Length），這個 IP 封包的表頭長度，使用單位是字組（word），一個自組為 4bytes</p>
</li>
<li><p>Type of Service</p>
<p>IP 封包的服務類型，主要分為以下</p>
<ul>
<li>PPP：此封包的優先度，目前少使用</li>
<li>D：0 表示一般延遲（delay），1 表示低延遲</li>
<li>T：0 表示一般傳輸量（throughput），1 表示高傳輸量</li>
<li>R：0 表示一般可靠度（reliability），1 表示高可靠度</li>
<li>UU：保留未使用</li>
</ul>
</li>
<li><p>Total Length</p>
<p>IP 封包的總長度，包含表頭與內容（Data），最大為 65535 bytes</p>
</li>
<li><p>Identifier</p>
<p>辨別碼，前面說到 IP 要放入 MAC 訊框內，若 IP 過大時，需要重組再放入 MAC 內，當重組時，就需要識別碼來知道這些重組的 IP 封包是屬於哪個大封包</p>
</li>
<li><p>Flags</p>
<p>此表示特殊旗標</p>
<ul>
<li>D：0 表示可分段，1 表示不可分段</li>
<li>M：0 表示此 IP 為最後分段，1 表示此 IP 非最後分段</li>
</ul>
</li>
<li><p>Fragment Offset</p>
<p>此 IP 分段在原始 IP 封包的位置（在第幾段），透過接收 Total Length, Identification, Flags 以及這個 Fragment Offset 即可將這些分段組合起來</p>
</li>
<li><p>Time to Live</p>
<p>TTL，表示此 IP 封包的存活時間，範圍是 0 - 255，當 IP 封包通過一個路由器時，TTL會減一，變成 0 時，封包會丟棄。</p>
</li>
<li><p>Protocol</p>
<p>協定代碼，此欄位紀錄每種資料封包的內容</p>
</li>
<li><p>Header Checksum</p>
<p>標頭檢查碼，用來檢查此 IP 表頭</p>
</li>
<li><p>Source Address</p>
<p>來源 IP 位址，此項為 32 位元</p>
</li>
<li><p>Destination Address</p>
<p>目標 IP 位址，此項為 32 位元</p>
</li>
<li><p>Options</p>
<p>額外功能，可放其他參數</p>
</li>
<li><p>Padding</p>
<p>因為 Options 的內容不一定，所以 當 Options不滿 32 bits 時，會由 padding 補齊</p>
</li>
</ul>
<p>後續 IP 的組成與機制，留在另一文章再討論</p>
<h3 id="TCP-IP-的傳輸層"><a href="#TCP-IP-的傳輸層" class="headerlink" title="TCP/IP 的傳輸層"></a>TCP/IP 的傳輸層</h3><p>在 OSI 的協定中，網路層的 IP 之上就是傳送層，其資料最常見的就是打包成 TCP 封包，並且需要放到 IP 的封包內，如下圖</p>
<p><img src="https://linux.vbird.org/linux_server/centos6/0110network_basic//packet_total.png" alt="packet_total"></p>
<center>封包間的相關性<br /><font color=#BBBBBB>圖片來源：</font><a target="_blank" rel="noopener" href="https://linux.vbird.org/">鳥哥伺服器篇</a></center>

<h4 id="TCP的表頭"><a href="#TCP的表頭" class="headerlink" title="TCP的表頭"></a>TCP的表頭</h4><p>以下就是 tcp 的表頭，下面就逐一介紹其資料，其中</p>
<p><img src="/image/2021-06-17-network-basic/tcp-header.png" alt="tcp-header"></p>
<center>tcp表頭示意圖<br /><font color=#BBBBBB>圖片來源：</font><a target="_blank" rel="noopener" href="https://linux.vbird.org/">鳥哥伺服器篇</a></center>

<ul>
<li><p>Source Port</p>
<p>來源埠口，連線的通道，client 與 server需要有這個通道來傳遞封包資料</p>
</li>
<li><p>Destination Port</p>
<p>目標埠口，意義同上</p>
</li>
<li><p>Sequence Number</p>
<p>封包的序號，當 tcp 的資料超過 IP 封包的大小時就必須分段，此序號可用來將 tcp 的資料組合</p>
</li>
<li><p>Acknowledge Number</p>
<p>回應序號，用來確認 server 有收到 client 送出的封包資料，當 client 發送封包至 server 後，server 就會發送此序號給 client，表示先前的封包已收到</p>
</li>
<li><p>Data Offset</p>
<p>用來說明整個封包區段的起始位置</p>
</li>
<li><p>Reserved</p>
<p>未使用的保留欄位</p>
</li>
<li><p>Code（Control Flag）</p>
<p>控制標誌碼，用來說明連線狀態，此欄位共有 6 個 bits，分別代表 6 個控制碼，1 表示啟動，以下為各個控制碼：</p>
<ul>
<li><p>URG（Urgent）</p>
<p>1 表示緊急封包，接收端要緊急處理</p>
</li>
<li><p>ACK（Acknowledge）</p>
<p>1 表示回應封包， 則與上面的 Acknowledge Number 有關</p>
</li>
<li><p>PSH（Push function）</p>
<p>1 表示要求對方立即傳送緩衝區內的其他對應封包</p>
</li>
<li><p>RST（Reset）</p>
<p>1 表示連線馬上結束，無需等待終止確認手續（發送端已斷線，強制結束）</p>
</li>
<li><p>SYN（Synchronous）</p>
<p>1 表示發送端希望雙方建立同步處理（主動要連接對方建立連線）</p>
</li>
<li><p>FIN（Finish）</p>
<p>1 表示傳送結束，詢問對方是否同意斷線</p>
</li>
</ul>
</li>
<li><p>Window</p>
<p>滑動視窗，單位是 byte，用來控制封包流量，可告知對方目前緩衝器容量（Receive Buffer）是否仍可接收封包。當 Window=0 時，表示緩衝器已滿</p>
</li>
<li><p>Checksum</p>
<p>確認檢查碼</p>
</li>
<li><p>Urgent Pointer</p>
<p>前面的 Code 欄位中，URG=1時才有作用</p>
</li>
<li><p>Options</p>
<p>目前此欄位僅應用於表示接收端可以接收的最大資料區段容量，若此欄位不使用， 表示可以使用任意資料區段的大小。</p>
</li>
<li><p>Padding</p>
<p>用來補足 Optional 的大小，兩者加起來必須是 32 bit</p>
</li>
</ul>
<h4 id="port"><a href="#port" class="headerlink" title="port"></a>port</h4><p>前面有提到 Source Port 與 Destination Port，這兩個都是 16 bit，對大皆可達 65535（2^16）個 port，當 server 與 client 要連線時，兩邊都需有一個對應的 port 來形成連線通道，假設沒有對應到對的 port，就算 IP 正確了也沒有用。</p>
<p>Internet 有需多規範好的 port，這些 port number 通常小於1024，在 linux 環境下，這些 port number 的對應預設寫在 <code>/etc/services</code>，底下則是常見的 port number 與服務的對應</p>
<table>
<thead>
<tr>
<th>連接 port</th>
<th>服務</th>
</tr>
</thead>
<tbody><tr>
<td>20</td>
<td>FTP-data，檔案傳輸協定所使用的主動資料傳輸 port</td>
</tr>
<tr>
<td>21</td>
<td>FTP，檔案傳輸協定的命令通道</td>
</tr>
<tr>
<td>22</td>
<td>SSH，較為安全的遠端連線伺服器</td>
</tr>
<tr>
<td>23</td>
<td>Telnet，早期的遠端連線伺服器軟體</td>
</tr>
<tr>
<td>25</td>
<td>SMTP，簡單郵件傳遞協定，用在作為 mail server 的 port</td>
</tr>
<tr>
<td>53</td>
<td>DNS，用在作為名稱解析的領域名稱伺服器</td>
</tr>
<tr>
<td>80</td>
<td>HTTP（HyperText Transport Protocol）</td>
</tr>
<tr>
<td>110</td>
<td>POP3，郵件收信協定</td>
</tr>
<tr>
<td>443</td>
<td>HTTPS，有安全加密機制的 HTTP</td>
</tr>
</tbody></table>
<p>上面這些小於 1024 的 port 皆需要 root 才能啟動，所以又被稱為 Privileged Ports，通常以上限制都在 server 上，因為 client 通常都是要資料而已，所以 client 的 port number 只要取一組大於 1024 且沒在用的 port number 即可。</p>
<p>網路要連線的話除了剛剛提的 port，也需要 IP 才能達成雙向連線，以下資料又稱為 Socket pair</p>
<ul>
<li>Source Address + Source Port</li>
<li>Destination Address + Destination Port</li>
</ul>
<h4 id="TCP-的連線機制"><a href="#TCP-的連線機制" class="headerlink" title="TCP 的連線機制"></a>TCP 的連線機制</h4><p>在封包連接時，建立連線需要三個確認的步驟，此方式被稱為三向交握（Three-way handshake），底下就來說明流程</p>
<p><img src="https://media.geeksforgeeks.org/wp-content/uploads/TCP-connection-1.png" alt="TCP-connection-1"></p>
<center>Three-way handshake<br /><font color=#BBBBBB>圖片來源：</font><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/tcp-3-way-handshake-process/">TCP 3-Way Handshake Process</a></center>

<p>上圖的 HOST P 可先視為 client，HOST Q 可視為 server，首先</p>
<ol>
<li><p>發起封包</p>
<p>client 想對 server 發起連線時，要發出一個要求連線的封包，此時 client要隨機取一個大於 1024 的 port，並在 TCP 的表頭中，帶著 SYN 的主動連線（SYN=1），並記下發送連線封包給伺服器端的序號（Sequence number = x）</p>
</li>
<li><p>封包接收與確認封包傳送</p>
<p>當 server 收到封包並確定接收時，就會製作另一個封包（syn=y，ack=x+1）傳給 client</p>
</li>
<li><p>回送確認封包</p>
<p>client 收到 server 傳來的 ACK 後（ack=x+1）以及序號SYN（syn=y）就知道發起封包被正確的接受了，若 client 也同意與 server 建立連線，那麼 client 就會再傳一個確認封包給 server（ack=y+1）</p>
</li>
<li><p>取得最後確認</p>
<p>server 收到 ack=y+1的封包後，就可以建立此次連線了</p>
</li>
</ol>
<h4 id="另一種協定：UDP"><a href="#另一種協定：UDP" class="headerlink" title="另一種協定：UDP"></a>另一種協定：UDP</h4><p>UDP（User Datagram Protocol）與TCP不同，他不提供可靠的傳輸模式，因為他不是連線導向的機制，在 UDP 的傳送中，不會回覆 ACK 給發送端，所以他不會確認對方是否正確的收到資料，所以其表頭資料也比較少，相對的，他可以在 Data 放入更多的資料，他的資源消耗小，處理速度快。</p>
<p>UDP 適合用於需及時反應，且不考慮資料的正確性的資料流，例如即時影像、音頻、視頻等等的資料。</p>
<h3 id="網路的防火牆"><a href="#網路的防火牆" class="headerlink" title="網路的防火牆"></a>網路的防火牆</h3><p>防火牆是一種可以監控傳入傳出的流量的資安裝置，其中封包過濾式的防火牆可以抵當一些可能有問題的封包，在 Linux 上，我們可以對封包表頭的分析，並且設定分析的規則，當發現某些特定的 IP 、特定的 port 以及特定的封包資訊（例如 SYN/ACK），就將那個封包給他丟棄， 這就是基本的防火牆原理。</p>
<p>若以 OSI 的七層協定來說，底下幾個都可以做特定的阻擋</p>
<ul>
<li><p>第二層（鏈結層）</p>
<p>針對來源與目標的 MAC 阻擋</p>
</li>
<li><p>第三層（網路層）</p>
<p>針對來源與目標的 IP 阻擋</p>
</li>
<li><p>第四層（傳送層）</p>
<p>針對 TCP/UDP 的 port 阻擋</p>
</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://arcobaleno18.pixnet.net/blog/post/201733936">關於網路的一些基本概念</a></li>
<li><a target="_blank" rel="noopener" href="http://linux.vbird.org/linux_server/0110network_basic.php#whatisnetwork_tcpip">基礎網路概念</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/network/" rel="tag"># network</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/06/14/git-for-teams-1/" rel="prev" title="git團隊使用手冊讀後心得(1)">
                  <i class="fa fa-chevron-left"></i> git團隊使用手冊讀後心得(1)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/06/25/introduce-ip/" rel="next" title="IP的基本介紹與使用">
                  IP的基本介紹與使用 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      <div class="comment-button-group">
          <a class="btn comment-button disqus">disqus</a>
          <a class="btn comment-button disqusjs">disqusjs</a>
      </div>
        <div class="comment-position disqus">
          
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
        </div>
        <div class="comment-position disqusjs">
          
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
        </div><script data-pjax src="/js/comments-buttons.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lionel</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  




<script class="next-config" data-name="disqus" type="application/json">{&quot;enable&quot;:&quot;ture&quot;,&quot;shortname&quot;:&quot;lionel223&quot;,&quot;count&quot;:false,&quot;i18n&quot;:{&quot;disqus&quot;:&quot;disqus&quot;}}</script>
<script src="/js/third-party/comments/disqus.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqusjs.css" integrity="sha256-GxdCIOyfxQ1OBfS99qAIJDoGK1ADuBsxhMTqXG82fAY=" crossorigin="anonymous">

<script class="next-config" data-name="disqusjs" type="application/json">{&quot;enable&quot;:true,&quot;api&quot;:&quot;https:&#x2F;&#x2F;disqus.skk.moe&#x2F;disqus&#x2F;&quot;,&quot;apikey&quot;:&quot;qQdEARuomIWB3sp0lcWI1GaWdJfiagymjTPsXp1E8IJiISMeuM5kaHUdXK87bHPx&quot;,&quot;shortname&quot;:&quot;lionel223&quot;,&quot;js&quot;:{&quot;url&quot;:&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;disqusjs@1.3.0&#x2F;dist&#x2F;disqus.js&quot;,&quot;integrity&quot;:&quot;sha256-LVaMHPQ2zLqOc5rXSAfr4d1PIkEGNLyyUTDNPZmTtUw&#x3D;&quot;}}</script>
<script src="/js/third-party/comments/disqusjs.js"></script>

</body>
</html>
