---
title:  "[Unix] bash基本使用(3)"
date: 2021-05-22 00:00:00
tags: ["unix","bash","command"]
categories: unix
---

環境變數就是使用者操作環境的一些設定，環境變數可以幫我們達到很多功能，例如執行檔搜尋的路徑等等的功能，有兩個指令可以查詢我們有多少預設的環境變數，分別是`env`跟`export`。以下就來介紹各個常用的環境變數

<!-- more -->

## 常用環境變數

使用指令`env`、`set`、`export`來列出各自的環境變數，以下就來分別說明

### env

使用指令`env`所列出的是所有的環境變數，底下列出幾個常用的變數

* HOME

  使用者的家目錄，使用指令`cd ~`時，就是取用這個變數，許多程式都可能有用到這個值

* SHELL

  此環境使用的SHELL，預設是`/bin/bash`

* PATH

  執行檔搜尋的路徑，各個目錄中間以冒號`:`分隔，長的形似類似這樣

  `/usr/local/bin:/usr/bin:/bin`

  執行檔案的搜尋是依序從`PATH`變數內的目錄查詢，所以順序也是很重要

* LANG

  語系資料，例如`zh_TW.UTF-8`或是`zh_TW.Big5`

### set

除了環境變數以外，也有一些是與bash操作介面有關的變數，以及使用者自定義的變數，此時可以使用指令`set`，他除了環境變數以外，也會把bash內的變數全部列出，底下列出幾個常用的變數

* PS1

  命令提示字元，這個是每次按下`[enter]`執行指令後，要顯示提示字元時會去讀取的變數值，底下列出幾個符號的意義，未來會再詳細介紹

  * `\d`：顯示日期格式『星期 月 日』的日期格式，例如`Sat May 22`
  * `\H`：顯示完整的主機名稱
  * `\h`：顯示第一個小數點前的主機名稱
  * `\t`：顯示時間，24小時格式『HH:MM:SS』
  * `\T`：顯示時間，12小時格式『HH:MM:SS』
  * `\A`：顯示時間，24小時格式『HH:MM』
  * `\@`：顯示時間，12小時格式『am/pm』
  * `\u`：顯示使用者帳號名稱
  * `\v`：Bash版本資訊
  * `\w`：由root開始的完整工作目錄名稱，若是家目錄則會以`~`取代
  * `\W`：使用basename函數取得的工作目錄名稱，僅會顯示最後一個目錄名
  * `\#`：下達的第幾個指令
  * `\$`：提示字元，一般顯示`$`，但若是root時，顯示`#`

* $

  此shell的PID（Process ID），可使用以下指令取得

  ```bash
  $ echo $$
  21007
  ```

* ?

  上一個執行指令的回傳值，一般成功指令會回傳`0`，但若執行過程出現錯誤，則會回傳錯誤代碼

### export

前面提了指令`env`與`set`，裡面也有環境變數與自訂變數的不同，兩者的差別就在於**變數是否會被子程序繼續引用**

當一開始進入terminal時，就會是一個獨立的程序（process），在這個bash底下使用的指令都是由這個bash衍生出來的，此時就稱這個process為父程序（parent process），執行指令時的程序則稱為子程序（child process），而子程序只會繼承父程序的環境變數，而不會繼承自訂變數，所以若要子程序使用父程序的自訂變數，就需要將它轉變成環境變數才可以，此時就可以使用指令`export`。

```bash
$ export 變數名稱
```

此方式可以將變數變成環境變數，使這個變數可以讓其餘呼叫的程序使用。

若是單獨使用指令`export`則會將所有的環境變數顯示出來

```bash
$ export
```

## 變數有效範圍

一般變數與環境變數在使用上的最大不同，就是一般變數有「使用範圍的限制」，在不同的程序關係時，變數可否使用就和指令`export`有關，被export後的變數，我們可以稱它為環境變數，環境變數可以被子程序使用。

子程序會繼承父程序的所有永久環境變數、臨時環境變數；但父程序不能使用子程序中定義的變數、環境變數

變數又分為以下幾種

1. 永久環境變數

   * `etc/profile`：永久生效，對所有使用者有效，需要重啟
   * `/etc/bashrc`：永久生效，對所有使用者有效，無需重啟
   * `~/.bashrc`：永久生效，僅對當前使用者所屬的shell有效

2. 臨時環境變數

   使用指令`export`，只對當前的程序以及其子程序有效

3. 普通變數

   僅能被當前程序使用，不可被其子程序使用，也不可被其他程序使用

### 使用情境

編寫的shell script若想引用一個用於宣告臨時環境變數的檔案，可以使用命令`source`

指令`source`使用方法

```shell
$ source filepath
```

使當前程序讀取filepath的shell script，並執行裡面的shell，通常用於重新執行剛修改的初始化檔案，使之立即生效，而不必登出並重新登入。例如，當我們修改了`/etc/profile`檔案，並想讓它立刻生效，而不用重新登入，就可以使用source命令，如`source /etc/profile`。

例如：SetEnvironment.sh裡面宣告普通的變數與臨時環境變數

```bash
#!/bin/bash

hostname=`hostname`

work_home=/opt/work
export work_home
```

在另一個程序裡面可以使用指令`source`讀取SetEnvironment.sh並執行後，即可使用裡面的變數

```bash
#!/bin/bash
source ./SetEnvironment.sh

echo $hostname
echo $work_home
```


## Reference
* [bash shell環境變數](https://crmne0707.pixnet.net/blog/post/319843802-bash-shell-%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8)
* [鳥哥的 Linux 私房菜 -- 第十章、認識與學習BASH](http://linux.vbird.org/linux_basic/0320bash.php)

